<ion-header>
  <ion-toolbar class="custom-toolbar">
    <ion-title>Minhas Consultas</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-segment [(ngModel)]="filtroStatus" (ionChange)="filtrarConsultas()">
    <ion-segment-button value="todas"><ion-label>Todas</ion-label></ion-segment-button>
    <ion-segment-button value="agendada"><ion-label>Agendadas</ion-label></ion-segment-button>
    <ion-segment-button value="concluida"><ion-label>Concluídas</ion-label></ion-segment-button>
    <ion-segment-button value="cancelada"><ion-label>Canceladas</ion-label></ion-segment-button>

  </ion-segment>

  @if (consultasFiltradas.length === 0) {
    <div class="sem-consultas">
      <ion-icon name="calendar-outline"></ion-icon>
      <h3>Nenhuma consulta encontrada</h3>
      <p>Você não possui consultas {{ filtroStatus !== 'todas' ? 'com este status' : '' }}</p>
    </div>
  }

  <ion-list>
    @for (consulta of consultasFiltradas; track $index) {
    <ion-item-sliding>
      <ion-item lines="full" [ngClass]="'status-' + (consulta.status || 'agendada').toLowerCase()">
        <ion-label>
          <h2 class="pet-nome">{{ consulta.animal.nome }}</h2>

          <p class="info-row">
            <ion-icon name="calendar-outline"></ion-icon>
            {{ consulta.data | date:'dd/MM/yyyy HH:mm' }}
          </p>

          <p class="info-row">
            <ion-icon name="person-outline"></ion-icon>
            {{ consulta.animal.dono.nome }}
          </p>

          <p class="info-row">
            <ion-icon name="paw-outline"></ion-icon>
            {{ consulta.animal.tipo_especie }} — {{ consulta.animal.raca }}
          </p>

          <p class="info-row">
            <ion-icon name="medkit-outline"></ion-icon>
            Dr(a). {{ consulta.veterinario.nome }}
          </p>
        </ion-label>

        <!-- Badge colorido no final -->
        <ion-badge slot="end" [ngClass]="'badge-' + (consulta.status || 'agendada').toLowerCase()">
          {{ consulta.status }}
        </ion-badge>
      </ion-item>

      <!-- Opção ao arrastar -->
      @if (consulta.status !== 'Cancelada' && consulta.status !== 'Concluida') {
        <ion-item-options side="end">
          <ion-item-option color="danger" (click)="cancelarConsulta(consulta)">
            <ion-icon slot="start" name="trash-outline"></ion-icon>
            Cancelar
          </ion-item-option>
        </ion-item-options>
      }

      
    </ion-item-sliding>
  }
  </ion-list>

</ion-content>
